<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <title>Vizualizacija: AVL Drevo</title>
    <style>
        :root { --node-color: #e67e22; --rotate-color: #2ecc71; --line: #bdc3c7; }
        body { font-family: 'Segoe UI', sans-serif; background: #fdfdfd; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 95%; max-width: 900px; text-align: center; }
        
        #treeCanvas { position: relative; width: 100%; height: 450px; margin-top: 40px; }
        
        .node {
            width: 40px; height: 40px; background: var(--node-color); color: white;
            border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-weight: bold; position: absolute; z-index: 2; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .height-label { position: absolute; top: -18px; font-size: 0.65rem; color: #7f8c8d; }

        .line { position: absolute; background: var(--line); height: 2px; transform-origin: 0 0; z-index: 1; transition: all 0.5s ease; }

        .controls { margin-top: 25px; display: flex; gap: 10px; justify-content: center; }
        input { padding: 10px; border: 2px solid #eee; border-radius: 6px; width: 80px; font-size: 1rem; }
        button { padding: 10px 20px; cursor: pointer; border: none; border-radius: 6px; font-weight: bold; color: white; background: #3498db; }
        #status { margin-top: 20px; font-weight: 500; color: #2c3e50; min-height: 1.5em; }
    </style>
</head>
<body>

    <div class="container">
        <h2>AVL Drevo (Self-Balancing BST)</h2>
        <p>Samodejno uravnoteženje z rotacijami. Višinska razlika (Balance Factor) je max ±1.</p>

        <div id="treeCanvas"></div>

        <div class="controls">
            <input type="number" id="valInput" placeholder="Število">
            <button onclick="add()">Vstavi in Uravnoteži</button>
            <button onclick="reset()" style="background:#e74c3c">Ponastavi</button>
        </div>
        <p id="status">Poskusite vstaviti zaporedna števila (npr. 1, 2, 3), da vidite rotacijo!</p>
    </div>

    <script>
        class Node {
            constructor(val) {
                this.val = val;
                this.left = null;
                this.right = null;
                this.height = 1;
            }
        }

        let root = null;
        const canvas = document.getElementById('treeCanvas');
        const status = document.getElementById('status');

        function getHeight(n) { return n ? n.height : 0; }
        function getBalance(n) { return n ? getHeight(n.left) - getHeight(n.right) : 0; }

        function rotateRight(y) {
            let x = y.left;
            let T2 = x.right;
            x.right = y;
            y.left = T2;
            y.height = Math.max(getHeight(y.left), getHeight(y.right)) + 1;
            x.height = Math.max(getHeight(x.left), getHeight(x.right)) + 1;
            return x;
        }

        function rotateLeft(x) {
            let y = x.right;
            let T2 = y.left;
            y.left = x;
            x.right = T2;
            x.height = Math.max(getHeight(x.left), getHeight(x.right)) + 1;
            y.height = Math.max(getHeight(y.left), getHeight(y.right)) + 1;
            return y;
        }

        function insert(node, val) {
            if (!node) return new Node(val);
            if (val < node.val) node.left = insert(node.left, val);
            else if (val > node.val) node.right = insert(node.right, val);
            else return node;

            node.height = 1 + Math.max(getHeight(node.left), getHeight(node.right));
            let balance = getBalance(node);

            // Left Left Case
            if (balance > 1 && val < node.left.val) return rotateRight(node);
            // Right Right Case
            if (balance < -1 && val > node.right.val) return rotateLeft(node);
            // Left Right Case
            if (balance > 1 && val > node.left.val) {
                node.left = rotateLeft(node.left);
                return rotateRight(node);
            }
            // Right Left Case
            if (balance < -1 && val < node.right.val) {
                node.right = rotateRight(node.right);
                return rotateLeft(node);
            }
            return node;
        }

        function draw(node, x, y, step) {
            if (!node) return;
            if (node.left) {
                drawLine(x, y, x - step, y + 70);
                draw(node.left, x - step, y + 70, step / 2);
            }
            if (node.right) {
                drawLine(x, y, x + step, y + 70);
                draw(node.right, x + step, y + 70, step / 2);
            }
            const div = document.createElement('div');
            div.className = 'node';
            div.innerHTML = `<span class="height-label">h=${node.height}</span>${node.val}`;
            div.style.left = `${x - 20}px`;
            div.style.top = `${y - 20}px`;
            canvas.appendChild(div);
        }

        function drawLine(x1, y1, x2, y2) {
            const len = Math.sqrt((x2-x1)**2 + (y2-y1)**2);
            const ang = Math.atan2(y2-y1, x2-x1) * 180 / Math.PI;
            const line = document.createElement('div');
            line.className = 'line';
            line.style.width = `${len}px`;
            line.style.left = `${x1}px`;
            line.style.top = `${y1}px`;
            line.style.transform = `rotate(${ang}deg)`;
            canvas.appendChild(line);
        }

        function add() {
            const v = parseInt(document.getElementById('valInput').value);
            if (isNaN(v)) return;
            root = insert(root, v);
            render();
            document.getElementById('valInput').value = '';
        }

        function render() {
            canvas.innerHTML = '';
            if (root) draw(root, canvas.offsetWidth/2, 40, canvas.offsetWidth/4);
        }

        function reset() { root = null; render(); }
        window.onresize = render;
    </script>
</body>
</html>
