<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <title>Vizualizacija: B-Tree (Red 3)</title>
    <style>
        :root { --node-bg: #34495e; --key-bg: #ecf0f1; --line: #bdc3c7; }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 95%; max-width: 1000px; text-align: center; }
        
        #treeCanvas { position: relative; width: 100%; min-height: 450px; margin-top: 40px; }
        
        .b-node {
            position: absolute; display: flex; background: var(--node-bg);
            border: 2px solid #2c3e50; border-radius: 6px; overflow: hidden;
            z-index: 2; transition: all 0.5s ease; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .key {
            padding: 8px 12px; background: var(--key-bg); color: #2c3e50;
            font-weight: bold; border-right: 1px solid #bdc3c7; min-width: 25px;
        }
        .key:last-child { border-right: none; }

        .line { position: absolute; background: var(--line); height: 2px; transform-origin: 0 0; z-index: 1; transition: all 0.5s ease; }

        .controls { margin: 20px 0; display: flex; gap: 10px; justify-content: center; }
        input { padding: 10px; border: 2px solid #ddd; border-radius: 6px; width: 80px; }
        button { padding: 10px 20px; cursor: pointer; border: none; border-radius: 6px; font-weight: bold; color: white; background: #27ae60; }
        #status { font-size: 0.9rem; color: #7f8c8d; }
    </style>
</head>
<body>

    <div class="container">
        <h2>B-drevo (B-Tree) - Red 3</h2>
        <p>Večpotno drevo: Vsako vozlišče ima lahko do 2 ključa in 3 otroke.</p>

        <div id="treeCanvas"></div>

        <div class="controls">
            <input type="number" id="valInput" placeholder="Število">
            <button onclick="add()">Vstavi</button>
            <button onclick="reset()" style="background:#e74c3c">Ponastavi</button>
        </div>
        <p id="status">B-drevesa rastejo <b>navzgor</b>, ko se vozlišča razcepijo (split).</p>
    </div>

    <script>
        // Poenostavljena implementacija B-drevesa reda 3 (2-3 drevo)
        class BTreeNode {
            constructor(isLeaf = true) {
                this.keys = [];
                this.children = [];
                this.isLeaf = isLeaf;
            }
        }

        let root = new BTreeNode();
        const T = 2; // Minimalna stopnja (Red = 2*T-1 = 3)
        const canvas = document.getElementById('treeCanvas');

        function splitChild(parent, i, fullChild) {
            let newNode = new BTreeNode(fullChild.isLeaf);
            // Vzamemo srednji element
            let midKey = fullChild.keys[T - 1];
            
            // Premaknemo ključe v novo vozlišče
            newNode.keys = fullChild.keys.splice(T, T - 1);
            if (!fullChild.isLeaf) {
                newNode.children = fullChild.children.splice(T, T);
            }
            fullChild.keys.pop(); // Odstranimo srednji element iz starega

            parent.children.splice(i + 1, 0, newNode);
            parent.keys.splice(i, 0, midKey);
        }

        function insertNonFull(node, k) {
            let i = node.keys.length - 1;
            if (node.isLeaf) {
                node.keys.push(null);
                while (i >= 0 && k < node.keys[i]) {
                    node.keys[i + 1] = node.keys[i];
                    i--;
                }
                node.keys[i + 1] = k;
            } else {
                while (i >= 0 && k < node.keys[i]) i--;
                i++;
                if (node.children[i].keys.length === 2 * T - 1) {
                    splitChild(node, i, node.children[i]);
                    if (k > node.keys[i]) i++;
                }
                insertNonFull(node.children[i], k);
            }
        }

        function insert(k) {
            let r = root;
            if (r.keys.length === 2 * T - 1) {
                let s = new BTreeNode(false);
                root = s;
                s.children.push(r);
                splitChild(s, 0, r);
                insertNonFull(s, k);
            } else {
                insertNonFull(r, k);
            }
        }

        function draw(node, x, y, width) {
            if (!node) return;

            const div = document.createElement('div');
            div.className = 'b-node';
            node.keys.forEach(k => {
                const kDiv = document.createElement('div');
                kDiv.className = 'key';
                kDiv.innerText = k;
                div.appendChild(kDiv);
            });
            
            canvas.appendChild(div);
            const nodeWidth = div.offsetWidth;
            div.style.left = `${x - nodeWidth / 2}px`;
            div.style.top = `${y}px`;

            if (!node.isLeaf) {
                const childCount = node.children.length;
                const step = width / childCount;
                node.children.forEach((child, i) => {
                    const nextX = (x - width / 2) + (step * i) + step / 2;
                    const nextY = y + 80;
                    drawLine(x, y + 35, nextX, nextY);
                    draw(child, nextX, nextY, step);
                });
            }
        }

        function drawLine(x1, y1, x2, y2) {
            const len = Math.sqrt((x2-x1)**2 + (y2-y1)**2);
            const ang = Math.atan2(y2-y1, x2-x1) * 180 / Math.PI;
            const line = document.createElement('div');
            line.className = 'line';
            line.style.width = `${len}px`;
            line.style.left = `${x1}px`;
            line.style.top = `${y1}px`;
            line.style.transform = `rotate(${ang}deg)`;
            canvas.appendChild(line);
        }

        function add() {
            const v = parseInt(document.getElementById('valInput').value);
            if (isNaN(v)) return;
            insert(v);
            render();
            document.getElementById('valInput').value = '';
        }

        function render() {
            canvas.innerHTML = '';
            draw(root, canvas.offsetWidth / 2, 20, canvas.offsetWidth * 0.8);
        }

        function reset() { root = new BTreeNode(); render(); }
        window.onresize = render;
        render();
    </script>
</body>
</html>
