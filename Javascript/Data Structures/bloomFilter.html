<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <title>Vizualizacija: Bloom Filter</title>
    <style>
        :root { --bit-off: #dfe6e9; --bit-on: #6c5ce7; --highlight: #fd79a8; }
        body { font-family: 'Segoe UI', sans-serif; background: #f9f9fb; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 95%; max-width: 800px; text-align: center; }
        
        .bit-array { display: flex; justify-content: center; gap: 4px; margin: 30px 0; flex-wrap: wrap; }
        .bit { 
            width: 35px; height: 45px; border: 1px solid #b2bec3; border-radius: 4px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--bit-off); transition: all 0.3s; font-size: 0.8rem; font-weight: bold;
        }
        .bit.on { background: var(--bit-on); color: white; border-color: #4834d4; }
        .bit.checking { background: var(--highlight); color: white; transform: scale(1.1); z-index: 5; }
        .bit-idx { font-size: 0.6rem; color: #636e72; margin-top: 2px; }

        .controls { display: flex; gap: 10px; justify-content: center; background: #f1f2f6; padding: 20px; border-radius: 8px; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 6px; width: 180px; }
        button { padding: 10px 15px; cursor: pointer; border: none; border-radius: 6px; font-weight: bold; color: white; background: #2d3436; }
        .btn-check { background: var(--highlight); }

        #status { margin-top: 20px; font-weight: 500; min-height: 1.5em; }
        .hash-info { font-size: 0.8rem; color: #636e72; margin-top: 10px; font-family: monospace; }
    </style>
</head>
<body>

    <div class="container">
        <h2>Bloom Filter</h2>
        <p>Probabilisti훾no preverjanje 훾lanstva. <b>O(1)</b> 훾as in minimalen prostor.</p>

        <div class="bit-array" id="bitArray">
            <!-- Biti se generirajo tukaj -->
        </div>

        <div class="controls">
            <input type="text" id="valInput" placeholder="Vnesi besedo...">
            <button onclick="add()">Dodaj (Add)</button>
            <button class="btn-check" onclick="check()">Preveri (Check)</button>
        </div>

        <div id="status">Vnesite besedo, da za훾nete.</div>
        <div class="hash-info" id="hashDetails"></div>
    </div>

    <script>
        const SIZE = 20;
        let bits = new Array(SIZE).fill(false);
        const bitDisplay = document.getElementById('bitArray');

        // Dve preprosti hash funkciji (za demonstracijo)
        function hash1(str) {
            let h = 0;
            for (let i = 0; i < str.length; i++) h += str.charCodeAt(i);
            return h % SIZE;
        }

        function hash2(str) {
            let h = 0;
            for (let i = 0; i < str.length; i++) h = (h << 5) - h + str.charCodeAt(i);
            return Math.abs(h) % SIZE;
        }

        function render(checkingIndices = []) {
            bitDisplay.innerHTML = '';
            bits.forEach((val, i) => {
                const div = document.createElement('div');
                div.className = `bit ${val ? 'on' : ''} ${checkingIndices.includes(i) ? 'checking' : ''}`;
                div.innerHTML = `<div>${val ? 1 : 0}</div><div class="bit-idx">${i}</div>`;
                bitDisplay.appendChild(div);
            });
        }

        function add() {
            const val = document.getElementById('valInput').value.trim();
            if (!val) return;

            const h1 = hash1(val);
            const h2 = hash2(val);
            
            bits[h1] = true;
            bits[h2] = true;

            document.getElementById('status').innerText = `Dodano: "${val}"`;
            document.getElementById('hashDetails').innerText = `Hashes: h1(${val})=${h1}, h2(${val})=${h2}`;
            render();
            document.getElementById('valInput').value = '';
        }

        async function check() {
            const val = document.getElementById('valInput').value.trim();
            if (!val) return;

            const h1 = hash1(val);
            const h2 = hash2(val);
            
            render([h1, h2]);
            await new Promise(r => setTimeout(r, 600));

            const maybeIn = bits[h1] && bits[h2];
            const status = document.getElementById('status');
            
            if (maybeIn) {
                status.innerHTML = `<span style="color: #e67e22;">Morda je v filtru!</span> (Oba bita sta 1)`;
            } else {
                status.innerHTML = `<span style="color: #d63031;">Zagotovo NI v filtru!</span> (Vsaj en bit je 0)`;
            }
            document.getElementById('hashDetails').innerText = `Checking: h1=${h1}, h2=${h2}`;
        }

        render();
    </script>
</body>
</html>
