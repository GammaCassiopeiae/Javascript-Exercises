<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <title>Vizualizacija: Quadtree</title>
    <style>
        :root { --primary: #0984e3; --border: #2d3436; --bg: #f8f9fa; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; }
        
        #canvas-container { position: relative; width: 400px; height: 400px; border: 2px solid var(--border); background: white; cursor: crosshair; margin: 20px auto; overflow: hidden; }
        .quad-line { position: absolute; background: #dfe6e9; z-index: 1; pointer-events: none; }
        .point { width: 6px; height: 6px; background: var(--primary); border-radius: 50%; position: absolute; transform: translate(-50%, -50%); z-index: 5; }

        .controls { margin-top: 20px; }
        button { padding: 10px 20px; cursor: pointer; border: none; border-radius: 6px; font-weight: bold; color: white; background: var(--border); }
        #status { margin-top: 15px; font-size: 0.9rem; color: #636e72; }
    </style>
</head>
<body>

    <div class="container">
        <h2>Štiriško drevo (Quadtree)</h2>
        <p>Klikni v kvadrat. Ko v regiji število točk preseže 1, se ta razdeli na 4 dele.</p>

        <div id="canvas-container" onclick="handleClick(event)">
            <!-- Točke in črte se generirajo tukaj -->
        </div>

        <div class="controls">
            <button onclick="reset()">Ponastavi</button>
        </div>
        <p id="status">Kapaciteta vozlišča = 1. Globina drevesa se povečuje dinamično.</p>
    </div>

    <script>
        const CAPACITY = 1;
        const container = document.getElementById('canvas-container');
        let points = [];

        class Point { constructor(x, y) { this.x = x; this.y = y; } }

        class Rectangle {
            constructor(x, y, w, h) {
                this.x = x; this.y = y; // center
                this.w = w; this.h = h; // pol-širina/višina
            }
        }

        class QuadTree {
            constructor(boundary) {
                this.boundary = boundary;
                this.points = [];
                this.divided = false;
            }

            subdivide() {
                let { x, y, w, h } = this.boundary;
                this.nw = new QuadTree(new Rectangle(x - w/2, y - h/2, w/2, h/2));
                this.ne = new QuadTree(new Rectangle(x + w/2, y - h/2, w/2, h/2));
                this.sw = new QuadTree(new Rectangle(x - w/2, y + h/2, w/2, h/2));
                this.se = new QuadTree(new Rectangle(x + w/2, y + h/2, w/2, h/2));
                this.divided = true;

                // Nariši črte delitve
                drawDivider(x, y - h, x, y + h); // vertikalna
                drawDivider(x - w, y, x + w, y); // horizontalna
            }

            insert(point) {
                if (!this.contains(this.boundary, point)) return false;

                if (this.points.length < CAPACITY && !this.divided) {
                    this.points.push(point);
                    return true;
                }

                if (!this.divided) this.subdivide();

                return (this.nw.insert(point) || this.ne.insert(point) || 
                        this.sw.insert(point) || this.se.insert(point));
            }

            contains(rect, p) {
                return (p.x >= rect.x - rect.w && p.x <= rect.x + rect.w &&
                        p.y >= rect.y - rect.h && p.y <= rect.y + rect.h);
            }
        }

        function drawDivider(x1, y1, x2, y2) {
            const line = document.createElement('div');
            line.className = 'quad-line';
            if (x1 === x2) { // vertikalna
                line.style.width = '1px';
                line.style.height = '100%';
                line.style.left = x1 + 'px';
                line.style.top = '0';
            } else { // horizontalna
                line.style.height = '1px';
                line.style.width = '100%';
                line.style.top = y1 + 'px';
                line.style.left = '0';
            }
            container.appendChild(line);
        }

        let qt = new QuadTree(new Rectangle(200, 200, 200, 200));

        function handleClick(e) {
            const rect = container.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const p = new Point(x, y);
            qt.insert(p);

            const dot = document.createElement('div');
            dot.className = 'point';
            dot.style.left = x + 'px';
            dot.style.top = y + 'px';
            container.appendChild(dot);
        }

        function reset() {
            container.innerHTML = '';
            qt = new QuadTree(new Rectangle(200, 200, 200, 200));
        }
    </script>
</body>
</html>
